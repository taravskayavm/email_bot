# Email Bot ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `.env`

## Dev checks
```bash
pip install pre-commit
pre-commit install
pre-commit run -a
```

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª `.env` (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π).
–í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `os.getenv`, –ø–æ—ç—Ç–æ–º—É **–∫–æ–¥ –ø—Ä–∞–≤–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ** ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `.env`.

## –ó–∞–ø—É—Å–∫ (legacy, python-telegram-bot)

```bash
pip install -r requirements.txt
# –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è pin: python-telegram-bot==13.15
python email_bot.py
```

## –ü–∞—Ä—Å–∏–Ω–≥ —Å–∞–π—Ç–æ–≤ –≤ –±–æ—Ç–µ

–û–¥–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞:

```text
/url https://example.com/page
```

–ì–ª—É–±–æ–∫–∏–π –æ–±—Ö–æ–¥ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–∞–Ω–∏—Ü):

```text
/crawl https://example.com
/crawl https://example.com --max-pages 80 --max-depth 3
/crawl https://example.com --prefix /staff,/contacts
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ .env
–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å–º. –≤ —Ñ–∞–π–ª–µ `.env.example`.

## –®–∞–±–ª–æ–Ω—ã –ø–∏—Å–µ–º

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Å—ã–ª–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTML-—à–∞–±–ª–æ–Ω, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–π –≤ –ø–∞–ø–∫–µ `templates/`.

- –í **—Ä–∞–±–æ—á–µ–π —Å—Ä–µ–¥–µ** —É –≤–∞—Å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:
  ```
  templates/medicine.html
  templates/sport.html
  templates/tourism.html
  templates/psychology.html
  templates/geography.html
  templates/bioinformatics.html
  ```

- –≠—Ç–∏ —Ñ–∞–π–ª—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–µ–∫—Å—Ç—ã —Ä–∞—Å—Å—ã–ª–æ–∫ –∏ –ø–æ–¥–ø–∏—Å–∏, –ø–æ—ç—Ç–æ–º—É –æ–Ω–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `.gitignore` –∏ **–Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø—É–±–ª–∏—á–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏**.

- –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –æ—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä—ã –≤ `templates/examples/`:
  ```
  templates/examples/medicine.html
  templates/examples/sport.html
  templates/examples/tourism.html
  ```
  –û–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤:
  - `{{BODY}}` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –ø–∏—Å—å–º–∞
  - `{{SIGNATURE}}` ‚Äî –ø–æ–¥–ø–∏—Å—å (–ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞:
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–≤–æ–∏ —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–∏—Å–µ–º –≤ `templates/`.
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç—É (—Å–æ–¥–µ—Ä–∂–∏—Ç `{{SIGNATURE}}` –∏–ª–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—Å—Ç–∞–≤–∫—É –ø–æ–¥–ø–∏—Å–∏).
3. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä—ã, –≤–∞—à–∏ —Ç–µ–∫—Å—Ç—ã –Ω–µ –ø–æ–ø–∞–¥—É—Ç –Ω–∞ GitHub.

## –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å `.env`
- –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (—Ä—è–¥–æ–º —Å –ø–∞–∫–µ—Ç–æ–º `emailbot/`).
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `.env` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è Git (—Å–º. `.gitignore`).
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ `.env` –≤ –ø—É–±–ª–∏—á–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö.

## –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```bash
# –ü–æ—á—Ç–∞
EMAIL_ADDRESS=your_name@mail.ru                 # –í–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –Ω–∞ mail.ru
EMAIL_PASSWORD=app_password_from_mailru         # –ü–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–µ –æ–±—ã—á–Ω—ã–π)

# Telegram
TELEGRAM_BOT_TOKEN= <REDACTED># –¢–æ–∫–µ–Ω @BotFather
```

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Mail.ru**: –ü–æ—á—Ç–∞ ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Üí –ü–∞—Ä–æ–ª–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π ‚Üí —Å–æ–∑–¥–∞—Ç—å –¥–ª—è ¬´–ü–æ—á—Ç–∞/SMTP/IMAP¬ª.

## –ü–æ—á—Ç–æ–≤—ã–µ —Å–µ—Ä–≤–µ—Ä—ã (IMAP/SMTP)
```bash
# IMAP (–¥–ª—è —á—Ç–µ–Ω–∏—è ¬´–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö¬ª, –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –∏ —Ç.–ø.)
IMAP_HOST=imap.mail.ru
IMAP_PORT=993

# SMTP (–æ—Ç–ø—Ä–∞–≤–∫–∞)
SMTP_HOST=smtp.mail.ru
SMTP_PORT=465          # 465 ‚Äî SSL, 587 ‚Äî STARTTLS
SMTP_SSL=1             # 1 = –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SMTP_SSL(465); 0 = SMTP+STARTTLS(587)
SMTP_TIMEOUT=45        # –¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è/–æ–ø–µ—Ä–∞—Ü–∏–π, —Å–µ–∫
```

> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –¥–ª—è Mail.ru –æ–±—ã—á–Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ `SMTP_SSL=1` –∏ `SMTP_PORT=465`.

## –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –æ–ø—Ü–∏–∏ –±–æ—Ç–∞
```bash
# –õ–æ–≥–æ –≤ –ø–∏—Å—å–º–∞—Ö (–µ—Å–ª–∏ —à–∞–±–ª–æ–Ω –µ–≥–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
INLINE_LOGO=1          # 1 = –≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ª–æ–≥–æ—Ç–∏–ø, 0 = –Ω–µ –≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å
```

## –†—É—á–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ ‚Äî –ø—Ä–∞–≤–∏–ª–æ 180 –¥–Ω–µ–π
–ë–æ—Ç –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ **–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å** –ø–∏—Å—å–º–∞ –∞–¥—Ä–µ—Å–∞—Ç–∞–º, –∫–æ—Ç–æ—Ä—ã–º —É–∂–µ –ø–∏—Å–∞–ª–∏ –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –¥–Ω–µ–π.
```bash
MANUAL_ENFORCE_180=1   # 1 = –≤–∫–ª—é—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ; 0 = –≤—ã–∫–ª—é—á–∏—Ç—å
MANUAL_DAYS=180        # –°—Ä–æ–∫ –¥–∞–≤–Ω–æ—Å—Ç–∏ –≤ –¥–Ω—è—Ö
MANUAL_ALLOW_OVERRIDE=1# 1 = –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å 180 –¥–Ω–µ–π)¬ª
```
–ü–æ–≤–µ–¥–µ–Ω–∏–µ:
- –ü—Ä–∏ –≤–≤–æ–¥–µ –≤—Ä—É—á–Ω—É—é —Å–ø–∏—Å–∫–∞ –∞–¥—Ä–µ—Å–æ–≤ –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **—Ç–æ–ª—å–∫–æ —Å—á—ë—Ç—á–∏–∫–∏**, –±–µ–∑ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –∞–¥—Ä–µ—Å–æ–≤:
  - ¬´–ö –æ—Ç–ø—Ä–∞–≤–∫–µ (–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ): X¬ª
  - ¬´–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –ø–æ –ø—Ä–∞–≤–∏–ª—É N –¥–Ω–µ–π: Y¬ª (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
  - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **—Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–º** (—Å—Ç—Ä–æ–≥–æ–µ –ø—Ä–∞–≤–∏–ª–æ);
  - –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º `MANUAL_ALLOW_OVERRIDE=1` –º–æ–∂–Ω–æ –Ω–∞–∂–∞—Ç—å ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º¬ª.

## –ë–ª–æ–∫-–ª–∏—Å—Ç –∞–¥—Ä–µ—Å–æ–≤
–ë–∞–∑–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ —Å–ª—É–∂–µ–±–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `no-reply`, `postmaster`) –∑–∞—à–∏—Ç –≤ –∫–æ–¥–µ –∏ –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞.
–†–∞—Å—à–∏—Ä–∏—Ç—å –±–ª–æ–∫-–ª–∏—Å—Ç –º–æ–∂–Ω–æ –æ–¥–Ω–∏–º –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤:

1) **–ß–µ—Ä–µ–∑ ENV** (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ, –ø—Ä–æ—Å—Ç—ã–µ —Å–ª—É—á–∞–∏):
```bash
FILTER_SUPPORT=0                   # 1 = –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å support@
FILTER_BLOCKLIST=help@x.com,foo@bar.io
```

2) **–û—Ç–¥–µ–ª—å–Ω—ã–º —Ñ–∞–π–ª–æ–º** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –≤–µ–¥–µ–Ω–∏—è):
- –°–æ–∑–¥–∞–π—Ç–µ `blocked_emails.txt` –∏ –≤–Ω–µ—Å–∏—Ç–µ –ø–æ –æ–¥–Ω–æ–º—É –∞–¥—Ä–µ—Å—É –Ω–∞ —Å—Ç—Ä–æ–∫—É.
- –§–∞–π–ª –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –≤ –ø—É–±–ª–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
- –í –∫–æ–¥–µ —É–∂–µ –µ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —á—Ç–µ–Ω–∏—è/–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ (—Å–º. `emailbot/messaging.py`: —Ñ—É–Ω–∫—Ü–∏–∏ `get_blocked_emails`, `dedupe_blocked_file` –∏ —Ç.–¥.).

## –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ (IMAP APPEND)
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π SMTP-–æ—Ç–ø—Ä–∞–≤–∫–∏ –±–æ—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª–æ–∂–∏—Ç—å –ø–∏—Å—å–º–æ –≤ –ø–∞–ø–∫—É ¬´–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ¬ª (—á–µ—Ä–µ–∑ IMAP APPEND).
–ü–∞–ø–∫–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (`detect_sent_folder`) –∏ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è –≤ `imap_sent_folder.txt`.
–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞—ë—Ç –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ¬ª), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ IMAP (modified UTF-7).

## –†–µ–∂–∏–º—ã SMTP –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏:
```bash
SMTP_MODE=auto            # auto|ssl|starttls (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ ‚Äî –±–æ—Ç –º–æ–∂–µ—Ç —Å–∞–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è)
SMTP_CONNECT_RETRIES=3    # –ü–æ–≤—Ç–æ—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ —Å–±–æ–µ
SMTP_CONNECT_BACKOFF=2    # –ë–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (—Å–µ–∫), —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ 2^n
```

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- –¢–∞–π–º–∞—É—Ç—ã/—Ä–∞–∑—Ä—ã–≤—ã: —É–≤–µ–ª–∏—á—å—Ç–µ `SMTP_TIMEOUT` –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ `SMTP_SSL=1 + SMTP_PORT=465`.
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –æ—Ç–ø—Ä–∞–≤–æ–∫: —Å–º–æ—Ç—Ä–∏–º ¬´–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ¬ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –ª–æ–∫–∞–ª—å–Ω—ã–π –∂—É—Ä–Ω–∞–ª (`logs/‚Ä¶`, –µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω).
- –í –ª–æ–≥–∞—Ö –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è:
  - –ø—Ä–æ–ø—É—Å–∫–∏ –ø–æ ¬´–¥—É–±–ª—é –∑–∞ —Å—É—Ç–∫–∏¬ª (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å),
  - –ø—Ä–æ–ø—É—Å–∫–∏ –ø–æ –±–ª–æ–∫-–ª–∏—Å—Ç—É,
  - –æ–∂–∏–¥–∞–Ω–∏—è rate-limit –ø–æ –¥–æ–º–µ–Ω—É.

## FAQ
**–í: –ì–¥–µ –º–µ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–æ—Ç–∞?**  
–û: –í `.env`. –ö–æ–¥ —É–∂–µ —á–∏—Ç–∞–µ—Ç –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `os.getenv`.

**–í: –ü–æ—á–µ–º—É –º–æ–∏ ¬´–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ¬ª –Ω–µ –Ω–∞—Ö–æ–¥—è—Ç?**  
–û: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `IMAP_HOST/PORT`, –¥–æ—Å—Ç—É–ø, –∏ —á—Ç–æ `imap_sent_folder.txt` —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è. –ü—Ä–∏ —Å–º–µ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ —É–¥–∞–ª–∏—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª ‚Äî –ø–∞–ø–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—Å—è –∑–∞–Ω–æ–≤–æ.

**–í: –ü–æ—á–µ–º—É –≤—Ä—É—á–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å –ø–∏—Å—å–º–∞ ¬´—Ä–∞–Ω—å—à–µ 180 –¥–Ω–µ–π¬ª?**
–û: –î–ª—è —Ä—É—á–Ω–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ —Ä–∞–Ω—å—à–µ –ø—Ä–∞–≤–∏–ª–æ –±—ã–ª–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ; —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç—Å—è `MANUAL_ENFORCE_180=1`. –ü—Ä–∏ `MANUAL_ALLOW_OVERRIDE=1` –º–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Ä–∞–∑—Ä–µ—à–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –≤—Å–µ–º.

## –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è e-mail

- –õ–æ–∫–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å (—Ç–æ, —á—Ç–æ —Å–ª–µ–≤–∞ –æ—Ç `@`) –¥–æ–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ **ASCII-—Å–∏–º–≤–æ–ª—ã**. –ê–¥—Ä–µ—Å–∞ —Å Unicode-–ª–æ–∫–∞–ª—å—é
  –æ—Ç–≤–µ—Ä–≥–∞—é—Ç—Å—è –∫–∞–∫ –Ω–µ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º SMTP-—Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ (–∫–æ–¥: `local_not_ascii`).
  –ü—Ä–∏–º–µ—Ä—ã –æ—Ç–∫–∞–∑–æ–≤: `–∏–º—è@–ø—Ä–∏–º–µ—Ä.—Ä—Ñ`.

- –î–æ–º–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å (—Å–ø—Ä–∞–≤–∞ –æ—Ç `@`) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Unicode –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –≤ **IDNA (Punycode)**.
  –ù–∞–ø—Ä–∏–º–µ—Ä: `user@–ø—Ä–∏–º–µ—Ä.—Ä—Ñ` ‚Üí `user@xn--e1afmkfd.xn--p1ai`.

- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
  - –ó–∞–ø—Ä–µ—â–µ–Ω—ã —Ç–æ—á–∫–∞ –≤ –Ω–∞—á–∞–ª–µ/–∫–æ–Ω—Ü–µ –ª–æ–∫–∞–ª–∏ –∏ –¥–≤–µ —Ç–æ—á–∫–∏ –ø–æ–¥—Ä—è–¥ –≤–Ω—É—Ç—Ä–∏ –ª–æ–∫–∞–ª–∏.
  - –î–ª–∏–Ω—ã –¥–æ–º–µ–Ω–∞ –∏ –ª–µ–π–±–ª–æ–≤ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è (RFC-—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–µ–ª—ã).
  - –í –æ—Ç—á—ë—Ç–µ –∏–º–ø–æ—Ä—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è **–ø—Ä–∏—á–∏–Ω—ã –æ—Ç–±—Ä–∞–∫–æ–≤–∫–∏** (—Å–º. –∫–æ–¥—ã –≤ —Ä–∞–∑–¥–µ–ª–µ `/ingest`).

## –ò–º–ø–æ—Ä—Ç –∞–¥—Ä–µ—Å–æ–≤ (`/ingest`)

–û—Ç–æ—à–ª–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É `/ingest` –∏ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ —Å–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å–æ–≤/—Å—Ç—Ä–æ–∫ ‚Äî –±–æ—Ç –∏–∑–≤–ª–µ—á—ë—Ç –≤–∞–ª–∏–¥–Ω—ã–µ e-mail, –ø–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –ø—Ä–∏–º–µ—Ä—ã.
–¢–µ–ø–µ—Ä—å –æ—Ç—á—ë—Ç –≤–∫–ª—é—á–∞–µ—Ç:

- `–ì–æ–¥–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤`, `–û—Ç–±—Ä–æ—à–µ–Ω–æ` –∏ `–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫`;
- –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –ø—Ä–∏—á–∏–Ω –æ—Ç–±—Ä–∞–∫–æ–≤–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `–ª–æ–∫–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å –Ω–µ ASCII`, `–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–æ–º–µ–Ω` –∏ —Ç.–ø.).

### –ü–∞—Ä—Å–∏–Ω–≥ URL

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ —á–∞—Ç **—Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å—Å—ã–ª–∫–æ–π** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://example.com/about`).
–ë–æ—Ç —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–≤–µ—Ç–∏—Ç ¬´–ü—Ä–∏–Ω—è–ª–∞ —Å—Å—ã–ª–∫—É‚Ä¶¬ª, –∑–∞—Ç–µ–º –ø—Ä–∏—à–ª—ë—Ç —Å–≤–æ–¥–∫—É —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤ –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏.

### –û–±—Ñ—É—Å—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ (`[at]/[dot]/¬´—Å–æ–±–∞–∫–∞/—Ç–æ—á–∫–∞¬ª`)
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–æ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç —Ç–∞–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, –Ω–æ —Å—Ç–æ–∏—Ç –∂—ë—Å—Ç–∫–∏–π –∞–Ω—Ç–∏-—Å–ø–∞–º —Ñ–∏–ª—å—Ç—Ä, —á—Ç–æ–±—ã –Ω–µ —Å–æ–±–∏—Ä–∞—Ç—å –º—É—Å–æ—Ä.
–ï—Å–ª–∏ —É –≤–∞—Å **—Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ü–∏—Ñ—Ä–æ–≤—ã–µ –ª–æ–∫–∞–ª–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä, ID-–ª–æ–≥–∏–Ω—ã), –≤–∫–ª—é—á–∏—Ç–µ:

```bash
export OBFUSCATION_ALLOW_NUMERIC_LOCAL=1
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å –∏ –æ–±—Ñ—É—Å—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ –≤–∏–¥–∞ `123456 [at] uni [dot] edu`.

### –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

–ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–∞–π–ª—ã: **PDF, DOCX, XLSX, CSV, ZIP** (—Å —ç—Ç–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ –≤–Ω—É—Ç—Ä–∏).
–ë–æ—Ç:
1) —Å–∫–∞—á–∞–µ—Ç —Ñ–∞–π–ª;
2) –∏–∑–≤–ª–µ—á—ë—Ç —Ç–µ–∫—Å—Ç –∏ e-mail-–∞–¥—Ä–µ—Å–∞;
3) –ø–æ–∫–∞–∂–µ—Ç –æ—Ç—á—ë—Ç, –≤–∫–ª—é—á–∞—è –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–±—Ä–∞–∫–æ–≤–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–ª–æ–∫–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å –Ω–µ ASCII¬ª).

> –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã:
> - `.xlsx` ‚Üí `openpyxl`
> - `.docx` ‚Üí `python-docx`
> - `.pdf` ‚Üí `pdfminer.six`
>
> –ï—Å–ª–∏ –ø–∞–∫–µ—Ç–∞ –Ω–µ—Ç, –±–æ—Ç –Ω–µ —É–ø–∞–¥—ë—Ç ‚Äî –æ–Ω —Å–æ–æ–±—â–∏—Ç, –∫–∞–∫—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å.

### OCR –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö PDF

–ï—Å–ª–∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–Ω–æ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü —Å–æ —Å—á—ë—Ç—á–∏–∫–æ–º `needs_ocr`, –≤–∫–ª—é—á–∏—Ç–µ OCR:

```bash
ENABLE_OCR=1    # –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ —Å–∫–∞–Ω–∞—Ö
OCR_PAGE_LIMIT=10  # –º–∞–∫—Å–∏–º—É–º —Å—Ç—Ä–∞–Ω–∏—Ü –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è OCR
OCR_TIME_LIMIT=30  # —Ç–∞–π–º–∞—É—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è, —Å–µ–∫—É–Ω–¥
```

OCR –¥–µ–ª–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –ø–æ—ç—Ç–æ–º—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ñ–ª–∞–≥ –≤—ã–∫–ª—é—á–µ–Ω. –ü—Ä–µ–¥–µ–ª—ã –ø–æ
—Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –∏ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–º–æ–≥–∞—é—Ç –∏–∑–±–µ–∂–∞—Ç—å ¬´–∑–∞–≤–∏—Å—à–∏—Ö¬ª –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚Äî –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –∏—Ö
–º–æ–∂–Ω–æ –æ—Å–ª–∞–±–∏—Ç—å, –Ω–æ –∏–º–µ–π—Ç–µ –≤ –≤–∏–¥—É —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏.

## –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –æ—Ç—á—ë—Ç—ã
- –ê—É–¥–∏—Ç –æ—Ç–ø—Ä–∞–≤–æ–∫ —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ `EMAILBOT_AUDIT_DIR` (–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `var`).
- –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–æ–º–∞–Ω–¥—ã `/stat_day`, `/stat_week`, `/stat_month`, `/stat_year` –∏ –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—é ¬´üìà –û—Ç—á—ë—Ç—ã¬ª.
- –í –æ—Ç—á—ë—Ç–µ –≤—ã–≤–æ–¥—è—Ç—Å—è —Å—É–º–º–∞—Ä–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∏ —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º —Å —É—á—ë—Ç–æ–º —Å—Ç–∞—Ç—É—Å–æ–≤ `ok` –∏ `err`.
- –ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –ø—É—Ç—å –∫ –∂—É—Ä–Ω–∞–ª–∞–º, –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Å—Ç—Ä–æ–∫—É `EMAILBOT_AUDIT_DIR=/path/to/audit`.
